<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login - RS Bazar</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
body { background: linear-gradient(135deg, #1a1a2e 0%, #0f3460 50%, #16213e 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
.login-container { background: #ffffff; border-radius: 16px; box-shadow: 0 20px 60px rgba(15, 52, 96, 0.4); width: 100%; max-width: 400px; padding: 40px 30px; }
.login-header { text-align: center; margin-bottom: 30px; }
.login-logo { width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #00eaff, #00d4ff); display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; font-size: 40px; }
.login-header h1 { font-size: 28px; font-weight: 900; color: #222; }
.login-header p { color: #666; font-size: 14px; }
.auth-tabs { display: flex; gap: 8px; justify-content: center; margin-bottom: 20px; }
.tab-btn { background: transparent; border: 1px solid #ddd; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-weight: 700; color: #333; }
.tab-btn.active { background: linear-gradient(90deg, #2b9be3, #1e7ab8); color: #fff; border-color: transparent; }
.tab-content { display: none; }
.tab-content.active { display: block; }
.form-group { margin-bottom: 20px; }
.form-group label { display: block; font-weight: 700; color: #333; margin-bottom: 8px; font-size: 14px; }
.form-group input { width: 100%; padding: 14px 16px; border: 2px solid #ddd; border-radius: 8px; font-size: 15px; background: #f9f9f9; }
.form-group input:focus { outline: none; border-color: #2b9be3; background: #fff; }
.login-btn { width: 100%; padding: 14px 20px; background: linear-gradient(90deg, #2b9be3, #1e7ab8); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: 800; cursor: pointer; margin-top: 10px; }
.login-btn:hover { transform: translateY(-2px); }
.error-msg { background: #fee; color: #c33; padding: 12px; border-radius: 8px; margin-bottom: 15px; display: none; }
.error-msg.show { display: block; }
.success-msg { background: #efe; color: #2a2; padding: 12px; border-radius: 8px; margin-bottom: 15px; display: none; }
.success-msg.show { display: block; }
.back-link { text-align: center; margin-top: 20px; }
.back-link a { color: #2b9be3; text-decoration: none; font-weight: 600; }
.demo-info { background: #f0f8ff; border: 1px solid #b3d9ff; padding: 14px; border-radius: 8px; margin-top: 20px; font-size: 13px; text-align: center; }
.demo-info strong { color: #2b9be3; display: block; margin-bottom: 6px; }
</style>
</head>
<body>

<div class="login-container">
    <div class="login-header">
        <div class="login-logo">üîê</div>
        <h1>RS Bazar</h1>
        <p>Login or Create Account</p>
    </div>
    
    <div class="error-msg" id="errorMsg"></div>
    <div class="success-msg" id="successMsg"></div>

    <div class="auth-tabs">
        <button class="tab-btn active" onclick="showTab('login')">Login</button>
        <button class="tab-btn" onclick="showTab('signup')">Sign Up</button>
    </div>

    <!-- LOGIN TAB -->
    <div class="tab-content active" id="loginTab">
        <form id="loginForm">
            <div class="form-group">
                <label>Username or Email</label>
                <input type="text" id="loginUsername" placeholder="Enter username or email" required>
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="loginPassword" placeholder="Enter password" required>
            </div>
            <button type="submit" class="login-btn">Login</button>
        </form>
    </div>

    <!-- SIGNUP TAB -->
    <div class="tab-content" id="signupTab">
        <form id="signupForm">
            <div class="form-group">
                <label>Username</label>
                <input type="text" id="signupUsername" placeholder="Choose username" required>
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="signupEmail" placeholder="Enter email" required>
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="signupPassword" placeholder="Choose password (min 6 chars)" required>
            </div>
            <div class="form-group">
                <label>Confirm Password</label>
                <input type="password" id="signupConfirm" placeholder="Repeat password" required>
            </div>
            <button type="submit" class="login-btn">Create Account</button>
        </form>
    </div>

    
    <div class="back-link">
        <a href="hlo.html">‚Üê Back to Home</a>
    </div>
</div>

<script>
// DEFAULT USERS - Stored in file (always available)
var DEFAULT_USERS = [
    { username: 'roshanshah', email: 'roshan@example.com', password: 'killer3051Q', isAdmin: true },
    { username: 'testuser', email: 'test@example.com', password: 'test123', isAdmin: false },
    { username: 'demo', email: 'demo@example.com', password: 'demo123', isAdmin: false }
];

// Get stored users from localStorage
function getStoredUsers() {
    try {
        return JSON.parse(localStorage.getItem('siteUsers')) || [];
    } catch(e) {
        return [];
    }
}

// Get all users (default + stored)
function getAllUsers() {
    var users = DEFAULT_USERS.slice();
    var stored = getStoredUsers();
    for (var i = 0; i < stored.length; i++) {
        var exists = false;
        for (var j = 0; j < users.length; j++) {
            if (users[j].username.toLowerCase() === stored[i].username.toLowerCase()) {
                exists = true;
                break;
            }
        }
        if (!exists) users.push(stored[i]);
    }
    return users;
}

// Find user by username or email
function findUser(identifier) {
    var id = identifier.toLowerCase().trim();
    var users = getAllUsers();
    for (var i = 0; i < users.length; i++) {
        if (users[i].username.toLowerCase() === id || 
            (users[i].email && users[i].email.toLowerCase() === id)) {
            return users[i];
        }
    }
    return null;
}

// Show tab
function showTab(tab) {
    document.getElementById('loginTab').classList.remove('active');
    document.getElementById('signupTab').classList.remove('active');
    document.querySelectorAll('.tab-btn').forEach(function(btn) { btn.classList.remove('active'); });
    
    if (tab === 'login') {
        document.getElementById('loginTab').classList.add('active');
        document.querySelectorAll('.tab-btn')[0].classList.add('active');
    } else {
        document.getElementById('signupTab').classList.add('active');
        document.querySelectorAll('.tab-btn')[1].classList.add('active');
    }
    
    document.getElementById('errorMsg').classList.remove('show');
    document.getElementById('successMsg').classList.remove('show');
}

// LOGIN FORM
document.getElementById('loginForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    var username = document.getElementById('loginUsername').value.trim();
    var password = document.getElementById('loginPassword').value;
    var errorMsg = document.getElementById('errorMsg');
    var successMsg = document.getElementById('successMsg');

    errorMsg.classList.remove('show');
    successMsg.classList.remove('show');

    if (!username || !password) {
        errorMsg.textContent = 'Please enter username and password';
        errorMsg.classList.add('show');
        return;
    }

    try {
        const data = await apiCall('/login', {
            method: 'POST',
            body: JSON.stringify({ identifier: username, password: password })
        });

        // Login successful
        localStorage.setItem('loggedInUser', data.user.username);
        localStorage.setItem('userId', data.user.id);
        if (data.user.is_admin) {
            localStorage.setItem('isAdmin', '1');
        } else {
            localStorage.removeItem('isAdmin');
        }

        successMsg.textContent = 'Login successful! Redirecting...';
        successMsg.classList.add('show');

        setTimeout(function() {
            if (data.user.is_admin) {
                window.location.href = 'admin.html';
            } else {
                window.location.href = 'hlo.html';
            }
        }, 1000);
    } catch (error) {
        errorMsg.textContent = error.message;
        errorMsg.classList.add('show');
    }
});

// SIGNUP FORM
document.getElementById('signupForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    var username = document.getElementById('signupUsername').value.trim();
    var email = document.getElementById('signupEmail').value.trim().toLowerCase();
    var password = document.getElementById('signupPassword').value;
    var confirm = document.getElementById('signupConfirm').value;
    var errorMsg = document.getElementById('errorMsg');
    var successMsg = document.getElementById('successMsg');

    errorMsg.classList.remove('show');
    successMsg.classList.remove('show');

    if (!username || !email || !password) {
        errorMsg.textContent = 'All fields are required';
        errorMsg.classList.add('show');
        return;
    }

    if (password.length < 6) {
        errorMsg.textContent = 'Password must be at least 6 characters';
        errorMsg.classList.add('show');
        return;
    }

    if (password !== confirm) {
        errorMsg.textContent = 'Passwords do not match';
        errorMsg.classList.add('show');
        return;
    }

    try {
        await apiCall('/register', {
            method: 'POST',
            body: JSON.stringify({ username: username, email: email, password: password })
        });

        successMsg.textContent = 'Account created! You can now login.';
        successMsg.classList.add('show');

        // Clear form and switch to login
        this.reset();
        setTimeout(function() { showTab('login'); }, 1500);
    } catch (error) {
        errorMsg.textContent = error.message;
        errorMsg.classList.add('show');
    }
});
</script>

</body>
</html>
